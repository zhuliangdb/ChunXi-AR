import{d as e,f as a,s as t,o as l,c as r,x as s,n as o,y as n,r as i,q as u,a as v,z as c,_ as d}from"./index-Dvp6MA4-.js";const h=["aria-label","aria-busy","aria-hidden"],p=["src","alt"],g={key:1,class:"lazy-image-placeholder"},y={key:2,class:"lazy-image-error"},b={class:"error-content"},m=["disabled"],w=d(e({__name:"LazyImage",props:{src:{},alt:{},retryAttempts:{},width:{},height:{},rootMargin:{},threshold:{},webp:{type:Boolean},quality:{}},emits:["load","error","retry"],setup(e,{emit:d}){const w=e,f=d,x=i(),C=i(!1),_=i(!1),z=i(0),M=i(!1),$=u(()=>{const e={};return w.width&&(e.width="number"==typeof w.width?`${w.width}px`:w.width),w.height&&(e.height="number"==typeof w.height?`${w.height}px`:w.height),e}),k=u(()=>{try{const e=new URL(w.src);return"http:"===e.protocol||"https:"===e.protocol?w.src:""}catch{return w.src}}),L=u(()=>k.value?M.value&&w.webp?k.value.includes("text_to_image")?k.value+(k.value.includes("?")?"&":"?")+"format=webp":k.value.replace(/\.(jpg|jpeg|png|gif)$/i,".webp"):k.value:""),H=w.retryAttempts||3,I=w.rootMargin||"300px 0px",V=w.threshold||.05,j=()=>{_.value=!0,f("error")},E=()=>{C.value=!0,f("load")},R=()=>{z.value<H&&(_.value=!1,C.value=!1,z.value++,f("retry"),x.value&&(null==Z||Z.observe(x.value)))};let Z=null;return a(()=>{(()=>{const e=document.createElement("canvas");e.getContext&&e.getContext("2d")&&(M.value=0===e.toDataURL("image/webp").indexOf("data:image/webp"))})(),x.value&&(Z=new IntersectionObserver(e=>{e.forEach(e=>{!e.isIntersecting||C.value||_.value||(C.value=!0,Z&&Z.unobserve(e.target))})},{rootMargin:I,threshold:V}),Z.observe(x.value))}),t(()=>{Z&&x.value&&Z.unobserve(x.value),Z&&(Z.disconnect(),Z=null)}),(a,t)=>(l(),r("div",{class:"lazy-image-container",ref_key:"containerRef",ref:x,style:s($.value),"aria-label":`图片: ${e.alt}`,"aria-busy":!C.value&&!_.value,"aria-hidden":_.value},[C.value&&!_.value?(l(),r("img",{key:0,src:L.value,alt:e.alt,class:o(["lazy-image",{"fade-in":!0}]),onError:j,onLoad:E,loading:"lazy"},null,40,p)):C.value||_.value?(l(),r("div",y,[n(a.$slots,"error",{},()=>[v("div",b,[t[1]||(t[1]=v("div",{class:"error-icon"},[v("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"currentColor"})])],-1)),t[2]||(t[2]=v("span",null,"图片加载失败",-1)),v("button",{type:"button",class:"retry-button",onClick:R,"aria-label":"重试加载图片",disabled:z.value>=c(H)}," 重试 ",8,m)])])])):(l(),r("div",g,[n(a.$slots,"placeholder",{},()=>[t[0]||(t[0]=v("div",{class:"placeholder-content"},[v("div",{class:"loading-spinner"}),v("span",null,"加载中...")],-1))])]))],12,h))}}),[["__scopeId","data-v-b988c122"]]);export{w as L};
